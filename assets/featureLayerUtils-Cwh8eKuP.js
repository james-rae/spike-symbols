const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./editingSupport-GoQ_ocjo.js","./spike-symbols.js","./spike-symbols.css","./EditBusLayer-Bv_F4e5M.js","./infoFor3D-CxdEiWhp.js"])))=>i.map(i=>d[i]);
import{o as s,u as a,bm as b,v as R,g2 as q,bX as P,aE as E,hG as D,a2 as N,bR as g,bV as G,hH as V,i3 as H,s as l,_ as $,i4 as B,i5 as C,i6 as T,d9 as k,i7 as Q,i8 as Z,i9 as z,a0 as v,bo as J}from"./spike-symbols.js";import{p as U}from"./jsonUtils-B7oYZIeQ.js";import{A as W}from"./UniqueValueRenderer-DpnAQyVY.js";var j;let p=j=class extends P{constructor(t){super(t),this.attachmentTypes=null,this.attachmentsWhere=null,this.cacheHint=void 0,this.keywords=null,this.globalIds=null,this.name=null,this.num=null,this.objectIds=null,this.returnMetadata=!1,this.size=null,this.start=null,this.where=null}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10}clone(){return new j(E({attachmentTypes:this.attachmentTypes,attachmentsWhere:this.attachmentsWhere,cacheHint:this.cacheHint,keywords:this.keywords,where:this.where,globalIds:this.globalIds,name:this.name,num:this.num,objectIds:this.objectIds,returnMetadata:this.returnMetadata,size:this.size,start:this.start}))}};s([a({type:[String],json:{write:!0}})],p.prototype,"attachmentTypes",void 0),s([a({type:String,json:{read:{source:"attachmentsDefinitionExpression"},write:{target:"attachmentsDefinitionExpression"}}})],p.prototype,"attachmentsWhere",void 0),s([a({type:Boolean,json:{write:!0}})],p.prototype,"cacheHint",void 0),s([a({type:[String],json:{write:!0}})],p.prototype,"keywords",void 0),s([a({type:[String],json:{write:!0}})],p.prototype,"globalIds",void 0),s([a({json:{write:!0}})],p.prototype,"name",void 0),s([a({type:Number,json:{read:{source:"resultRecordCount"}}})],p.prototype,"num",void 0),s([a({type:[Number],json:{write:!0}})],p.prototype,"objectIds",void 0),s([a({type:Boolean,json:{default:!1,write:!0}})],p.prototype,"returnMetadata",void 0),s([a({type:[Number],json:{write:!0}})],p.prototype,"size",void 0),s([a({type:Number,json:{read:{source:"resultOffset"}}})],p.prototype,"start",void 0),s([b("start"),b("num")],p.prototype,"writeStart",null),s([a({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],p.prototype,"where",void 0),p=j=s([R("esri.rest.support.AttachmentQuery")],p),p.from=q(p);const X=p;var x;let c=x=class extends P{constructor(t){super(t),this.cacheHint=void 0,this.dynamicDataSource=void 0,this.gdbVersion=null,this.geometryPrecision=void 0,this.historicMoment=null,this.maxAllowableOffset=void 0,this.objectIds=null,this.orderByFields=null,this.outFields=null,this.outSpatialReference=null,this.relationshipId=void 0,this.start=void 0,this.num=void 0,this.returnGeometry=!1,this.returnM=void 0,this.returnZ=void 0,this.where=null}_writeHistoricMoment(t,e){e.historicMoment=t&&t.getTime()}writeStart(t,e){e.resultOffset=this.start,e.resultRecordCount=this.num||10,this.start>0&&this.where==null&&(e.definitionExpression="1=1")}clone(){return new x(E({cacheHint:this.cacheHint,dynamicDataSource:this.dynamicDataSource,gdbVersion:this.gdbVersion,geometryPrecision:this.geometryPrecision,historicMoment:this.historicMoment&&new Date(this.historicMoment.getTime()),maxAllowableOffset:this.maxAllowableOffset,objectIds:this.objectIds,orderByFields:this.orderByFields,outFields:this.outFields,outSpatialReference:this.outSpatialReference,relationshipId:this.relationshipId,start:this.start,num:this.num,returnGeometry:this.returnGeometry,where:this.where,returnZ:this.returnZ,returnM:this.returnM}))}};s([a({type:Boolean,json:{write:!0}})],c.prototype,"cacheHint",void 0),s([a({type:D,json:{write:!0}})],c.prototype,"dynamicDataSource",void 0),s([a({type:String,json:{write:!0}})],c.prototype,"gdbVersion",void 0),s([a({type:Number,json:{write:!0}})],c.prototype,"geometryPrecision",void 0),s([a({type:Date})],c.prototype,"historicMoment",void 0),s([b("historicMoment")],c.prototype,"_writeHistoricMoment",null),s([a({type:Number,json:{write:!0}})],c.prototype,"maxAllowableOffset",void 0),s([a({json:{write:!0}})],c.prototype,"objectIds",void 0),s([a({type:[String],json:{write:!0}})],c.prototype,"orderByFields",void 0),s([a({type:[String],json:{write:!0}})],c.prototype,"outFields",void 0),s([a({type:N,json:{read:{source:"outSR"},write:{target:"outSR"}}})],c.prototype,"outSpatialReference",void 0),s([a({json:{write:!0}})],c.prototype,"relationshipId",void 0),s([a({type:Number,json:{read:{source:"resultOffset"}}})],c.prototype,"start",void 0),s([b("start"),b("num")],c.prototype,"writeStart",null),s([a({type:Number,json:{read:{source:"resultRecordCount"}}})],c.prototype,"num",void 0),s([a({json:{write:!0}})],c.prototype,"returnGeometry",void 0),s([a({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],c.prototype,"returnM",void 0),s([a({type:Boolean,json:{write:{overridePolicy:t=>({enabled:t})}}})],c.prototype,"returnZ",void 0),s([a({type:String,json:{read:{source:"definitionExpression"},write:{target:"definitionExpression"}}})],c.prototype,"where",void 0),c=x=s([R("esri.rest.support.RelationshipQuery")],c),c.from=q(c);const F=c,ut=Object.freeze(Object.defineProperty({__proto__:null,default:F},Symbol.toStringTag,{value:"Module"}));async function K(t,e,n){e=e.clone(),t.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=_(t));const r=Y(t),o=t.capabilities.query.supportsPagination;e.start=0,e.num=r;let i=null;for(;;){const u=await t.source.queryFeaturesJSON(e,n);if(i==null?i=u:i.features=i.features.concat(u.features),i.exceededTransferLimit=u.exceededTransferLimit,!o||!u.exceededTransferLimit)break;e.start+=r}return i}function Y(t){return _(t)*tt(t)}function tt(t){return t.capabilities.query.maxRecordCount||2e3}function _(t){return t.capabilities.query.supportsMaxRecordCountFactor?g.MAX_MAX_RECORD_COUNT_FACTOR:1}const ct=new G({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"});async function lt(t,e,n,r){const o=await w(t);if(await S(t,e,r),!o.addAttachment)throw new l(r,"Layer source does not support addAttachment capability");return o.addAttachment(e,n)}function S(t,e,n){var i,u;const{attributes:r}=e,{objectIdField:o}=t;return(u=(i=t.capabilities)==null?void 0:i.data)!=null&&u.supportsAttachment?e?r?o&&r[o]?Promise.resolve():Promise.reject(new l(n,`feature is missing the identifying attribute ${o}`)):Promise.reject(new l(n,"'attributes' are required on a feature to query attachments")):Promise.reject(new l(n,"A feature is required to add/delete/update attachments")):Promise.reject(new l(n,"this layer doesn't support attachments"))}async function pt(t,e,n,r,o){const i=await w(t);if(await S(t,e,o),!i.updateAttachment)throw new l(o,"Layer source does not support updateAttachment capability");return i.updateAttachment(e,n,r)}async function dt(t,e,n){const{applyEdits:r}=await $(()=>import("./editingSupport-GoQ_ocjo.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),o=await t.load();let i=n;return o.type==="feature"&&o.infoFor3D&&e.deleteFeatures!=null&&o.globalIdField!=null&&(i={...i,globalIdToObjectId:await rt(o,e.deleteFeatures,o.globalIdField)}),r(o,o.source,e,n)}async function yt(t,e,n){const{uploadAssets:r}=await $(()=>import("./editingSupport-GoQ_ocjo.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url),o=await t.load();return r(o,o.source,e,n)}async function ht(t,e,n,r){const o=await w(t);if(await S(t,e,r),!o.deleteAttachments)throw new l(r,"Layer source does not support deleteAttachments capability");return o.deleteAttachments(e,n)}async function ft(t,e,n){const r=(await t.load({signal:e==null?void 0:e.signal})).source;if(!r.fetchRecomputedExtents)throw new l(n,"Layer source does not support fetchUpdates capability");return r.fetchRecomputedExtents(e)}async function mt(t,e,n,r){var A,M;e=X.from(e),await t.load();const o=t.source,i=t.capabilities;if(!((A=i==null?void 0:i.data)!=null&&A.supportsAttachment))throw new l(r,"this layer doesn't support attachments");const{attachmentTypes:u,objectIds:d,globalIds:y,num:h,size:f,start:m,where:O}=e;if(!((M=i==null?void 0:i.operations)!=null&&M.supportsQueryAttachments)&&((u==null?void 0:u.length)>0||(y==null?void 0:y.length)>0||(f==null?void 0:f.length)>0||h||m||O))throw new l(r,"when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",e);if(!(d!=null&&d.length||y!=null&&y.length||O))throw new l(r,"'objectIds', 'globalIds', or 'where' are required to perform attachment query",e);if(!o.queryAttachments)throw new l(r,"Layer source does not support queryAttachments capability",e);return o.queryAttachments(e)}async function wt(t,e,n,r){const o=await w(t);if(!o.queryObjectIds)throw new l(r,"Layer source does not support queryObjectIds capability");return o.queryObjectIds(g.from(e)??t.createQuery(),n)}async function bt(t,e,n,r){const o=await w(t);if(!o.queryFeatureCount)throw new l(r,"Layer source does not support queryFeatureCount capability");return o.queryFeatureCount(g.from(e)??t.createQuery(),n)}async function gt(t,e,n,r){const o=await w(t);if(!o.queryExtent)throw new l(r,"Layer source does not support queryExtent capability");return o.queryExtent(g.from(e)??t.createQuery(),n)}async function vt(t,e,n,r){const o=await w(t);if(!o.queryRelatedFeatures)throw new l(r,"Layer source does not support queryRelatedFeatures capability");return o.queryRelatedFeatures(F.from(e),n)}async function It(t,e,n,r){const o=await w(t);if(!o.queryRelatedFeaturesCount)throw new l(r,"Layer source does not support queryRelatedFeaturesCount capability");return o.queryRelatedFeaturesCount(F.from(e),n)}async function jt(t){const e=t.source;if(e!=null&&e.refresh)try{const{dataChanged:n,updates:r}=await e.refresh();if(r!=null&&(t.sourceJSON={...t.sourceJSON,...r},t.read(r,{origin:"service",url:t.parsedUrl})),n)return!0}catch{}if(t.definitionExpression)try{return(await B(t.definitionExpression,t.fieldsIndex)).hasDateFunctions}catch{}return!1}function xt(t){var u,d;const e=new g,n=(u=t.capabilities)==null?void 0:u.data,r=(d=t.capabilities)==null?void 0:d.query;e.historicMoment=t.historicMoment,e.gdbVersion=t.gdbVersion,e.returnGeometry=!0,r&&(e.compactGeometryEnabled=r.supportsCompactGeometry,e.defaultSpatialReferenceEnabled=r.supportsDefaultSpatialReference),n&&(n.supportsZ&&t.returnZ!=null&&(e.returnZ=t.returnZ),n.supportsM&&t.returnM!=null&&(e.returnM=t.returnM)),e.outFields=["*"];const{timeOffset:o,timeExtent:i}=t;return e.timeExtent=o!=null&&i!=null?i.offset(-o.value,o.unit):i||null,e.multipatchOption=t.geometryType==="multipatch"?"xyFootprint":null,e}function Ft(t){const{globalIdField:e,fields:n}=t;if(e)return e;if(n){for(const r of n)if(r.type==="esriFieldTypeGlobalID")return r.name}}function St(t){const{objectIdField:e,fields:n}=t;if(e)return e;if(n){for(const r of n)if(r.type==="esriFieldTypeOID")return r.name}}function Ot(t){return t.currentVersion?t.currentVersion:t.hasOwnProperty("capabilities")||t.hasOwnProperty("drawingInfo")||t.hasOwnProperty("hasAttachments")||t.hasOwnProperty("htmlPopupType")||t.hasOwnProperty("relationships")||t.hasOwnProperty("timeInfo")||t.hasOwnProperty("typeIdField")||t.hasOwnProperty("types")?10:9.3}function At(t,e){const{subtypes:n,subtypeField:r}=t;if(!(e!=null&&e.attributes)||!(n!=null&&n.length)||!r)return null;const o=e.attributes[r];return o==null?null:n.find(i=>i.code===o)}function Mt(t,e){var u,d;const{fieldsIndex:n,subtypeField:r}=t,{name:o,type:i}=n.get(e)??{};if(!o)return null;if((r&&((u=n.get(r))==null?void 0:u.name))===o&&((d=t.subtypes)!=null&&d.length)){const y=t.subtypes.map(h=>new C({code:L(h.code,i),name:h.name}));if(y!=null&&y.length)return new T({codedValues:y})}return null}function Rt(t,e){var i,u;const{fieldsIndex:n}=t,{name:r,type:o}=n.get(e)??{};if(!r)return null;if(("typeIdField"in t?(i=n.get(t.typeIdField))==null?void 0:i.name:null)===r&&"types"in t&&((u=t.types)!=null&&u.length)){const d=t.types.map(y=>new C({code:L(y.id,o),name:y.name}));return new T({codedValues:d})}return null}function L(t,e){return e?k({type:e})&&typeof t=="number"?`${t}`:Q({type:e})&&typeof t=="string"?Number.parseInt(t,10):t:t}async function w(t){return(await t.load()).source}async function et(t,e){if(!v||v.findCredential(t))return;let n;try{const r=await J(t,e);r&&(n=await v.checkSignInStatus(`${r}/sharing`))}catch{}if(n)try{const r=e!=null?e.signal:null;await v.getCredential(t,{signal:r})}catch{}}async function qt(t,e,n){var o;const r=(o=t.parsedUrl)==null?void 0:o.path;r&&t.authenticationTriggerEvent===e&&await et(r,n)}function Pt(t){return!nt(t)&&(t.userHasUpdateItemPrivileges||t.editingEnabled)}const I=V({types:H});function Et(t,e){var n;if(t.defaultSymbol)return(n=t.types)!=null&&n.length?new W({defaultSymbol:I(t.defaultSymbol,t,e),field:t.typeIdField,uniqueValueInfos:t.types.map(r=>({id:r.id,symbol:I(r.symbol,r,e)}))}):new U({symbol:I(t.defaultSymbol,t,e)})}function $t(t){var r,o,i;let e=(r=t.sourceJSON)==null?void 0:r.cacheMaxAge;if(!e)return!1;const n=(i=(o=t.editingInfo)==null?void 0:o.lastEditDate)==null?void 0:i.getTime();return n==null||(e*=1e3,Date.now()-n<e)}async function rt(t,e,n){if(e==null)return null;const r=[],{objectIdField:o}=t;if(e.forEach(h=>{let f=null;if("attributes"in h){const{attributes:m}=h;f={globalId:m[n],objectId:m[o]!=null&&m[o]!==-1?m[o]:null}}else f={globalId:h.globalId,objectId:h.objectId!=null&&h.objectId!==-1?h.objectId:null};f.globalId!=null&&(f.objectId!=null&&f.objectId!==-1||r.push(f.globalId))}),r.length===0)return null;const i=t.createQuery();i.where=r.map(h=>`${n}='${h}'`).join(" OR "),i.returnGeometry=!1,i.outFields=[o,n],i.cacheHint=!1;const u=await Z(K(t,i));if(!u.ok)return null;const d=new Map,y=u.value.features;for(const h of y){const f=h.attributes[n],m=h.attributes[o];f!=null&&m!=null&&m!==-1&&d.set(z(f),m)}return d}function Ct(t,e,n){if(!e||!n||!t)return null;const r=n.getAttribute(e);return r==null?null:t.find(o=>{const{id:i}=o;return i!=null&&i.toString()===r.toString()})??null}function nt(t){var e;return((e=t.sourceJSON)==null?void 0:e.isMultiServicesView)||ot(t)}function ot(t){var e,n;return!!((n=(e=t.sourceJSON)==null?void 0:e.capabilities)!=null&&n.toLowerCase().split(",").map(r=>r.trim()).includes("map"))}function Tt(t,e,n){const r=e==null?void 0:e.queryBins;if(!r)throw new l(n,"Layer source does not support binning");switch(t.binParameters.type){case"auto-interval":if(!r.supportsAutoInterval)throw new l(n,"Layer source does not support auto-interval binning");break;case"date":if(!r.supportsDate)throw new l(n,"Layer source does not support date binning");break;case"fixed-boundaries":if(!r.supportsFixedBoundaries)throw new l(n,"Layer source does not support fixed-boundaries binning");break;case"fixed-interval":if(!r.supportsFixedInterval)throw new l(n,"Layer source does not support fixed-interval binning")}const o=r==null?void 0:r.supportedStatistics;if(t.outStatistics&&o){const i=new Map([["count","count"],["sum","sum"],["min","min"],["max","max"],["avg","avg"],["stddev","stddev"],["var","var"],["percentile-continuous","percentileContinuous"],["percentile-discrete","percentileDiscrete"],["centroid-aggregate","centroid"],["convex-hull-aggregate","convexHull"],["envelope-aggregate","envelope"]]);for(const{statisticType:u}of t.outStatistics){const d=i.get(u);if(d&&!o[d])throw new l(n,`Layer source does not support ${u} statistic type`)}}}export{ht as A,$t as B,It as C,St as D,gt as E,pt as F,Ot as G,lt as I,qt as J,rt as K,vt as L,xt as M,wt as O,bt as P,At as Q,jt as R,mt as S,Mt as T,Rt as U,Ft as V,Ct as W,nt as X,Pt as Z,Tt as _,ut as a,X as c,F as d,ct as g,dt as q,ft as v,yt as x,Et as z};
//# sourceMappingURL=featureLayerUtils-Cwh8eKuP.js.map
