{"version":3,"file":"FieldsIndex-iG3PpdUf.js","sources":["../../node_modules/@arcgis/core/layers/support/FieldsIndex.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport e from\"../../core/Error.js\";import{isSerializable as i}from\"../../core/JSONSupport.js\";import t from\"../../core/Logger.js\";import{getOrCreateMapValue as s}from\"../../core/MapUtils.js\";import{UnknownTimeZone as n}from\"../../core/sql/UnknownTimeZone.js\";import{isDateField as r,isNumericField as l,isObjectIDField as o,isGlobalIDField as d,getFieldDefaultValue as a,isTimeOnlyField as m,normalizeFieldName as u}from\"./fieldUtils.js\";import{utc as f,unknown as F,fromTimeReference as h}from\"../../time/timeZoneUtils.js\";import{FixedOffsetZone as c,IANAZone as p}from\"luxon\";function y(e){return\"timeZone\"in e}function _(e){return\"timeZone\"in e}function g(e){return\"dateFieldsTimeZone\"in e}const T=new Map;class Z{static fromJSON(e){return new Z(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new Z(e.fields??[],S(e))}static fromLayerJSON(e){return new Z(e.fields??[],S(e))}constructor(e=[],i){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=i?new Map(i):null;const t=[];for(const s of this.fields){const e=s?.name,i=M(e);if(e&&i){const n=w(e);this._fieldsMap.set(e,s),this._fieldsMap.set(n,s),this._normalizedFieldsMap.set(i,s),t.push(`${n}:${s.type}:${this._timeZoneByFieldName?.get(e)}`),r(s)?(this.dateFields.push(s),this._dateFieldsSet.add(s)):l(s)&&(this._numericFieldsSet.add(s),this.numericFields.push(s)),o(s)||d(s)||(s.editable=null==s.editable||!!s.editable,s.nullable=null==s.nullable||!!s.nullable)}}t.sort(),this.uid=t.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)o(e)||d(e)||e.nullable||void 0!==a(e)||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return null!=this.get(e)}get(e){if(!e)return;let i=this._fieldsMap.get(e);return i||(i=this._fieldsMap.get(w(e))??this._normalizedFieldsMap.get(M(e)),i&&this._fieldsMap.set(e,i),i)}getTimeZone(i){const s=this.get(i&&\"string\"!=typeof i?i.name:i);return s?this._timeZoneByFieldName?this._timeZoneByFieldName.get(s.name):\"date\"===s.type||\"esriFieldTypeDate\"===s.type?(t.getLogger(\"esri.layers.support.FieldsIndex\").error(new e(\"getTimeZone:no-timezone-information\",`no time zone information for field '${s.name}'`)),f):N.has(s.type)?F:null:null}getLuxonTimeZone(e){const i=this.getTimeZone(e);return i?i===F?n.instance:i===f?c.utcInstance:s(T,i,(()=>p.create(i))):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return m(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map((e=>i(e)?e.toJSON():e)),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function w(e){return e.trim().toLowerCase()}function M(e){return u(e)?.toLowerCase()??\"\"}const N=new Set([\"time-only\",\"date-only\",\"timestamp-offset\",\"esriFieldTypeDateOnly\",\"esriFieldTypeTimeOnly\",\"esriFieldTypeTimestampOffset\"]);function S(e){const i=new Map;if(!e.fields)return i;const t=!0===e.datesInUnknownTimezone,{timeInfo:s,editFieldsInfo:n}=e,r=(s?\"startField\"in s?s.startField:s.startTimeField:\"\")??\"\",l=(s?\"endField\"in s?s.endField:s.endTimeField:\"\")??\"\",o=g(e)?e.dateFieldsTimeZone??null:e.dateFieldsTimeReference?h(e.dateFieldsTimeReference):null,d=n?y(n)?n.timeZone??o:n.dateFieldsTimeReference?h(n.dateFieldsTimeReference):o??f:null,a=s?_(s)?s.timeZone??o:s.timeReference?h(s.timeReference):o:null,m=new Map([[w(n?.creationDateField??\"\"),d],[w(n?.editDateField??\"\"),d],[w(r),a],[w(l),a]]);for(const{name:u,type:f}of e.fields)if(N.has(f))i.set(u,F);else if(\"date\"!==f&&\"esriFieldTypeDate\"!==f)i.set(u,null);else if(t)i.set(u,F);else{const e=m.get(w(u??\"\"))??o;i.set(u,e)}return i}export{Z as default};\n"],"names":["y","e","_","g","T","Z","S","t","s","i","M","n","w","_a","r","l","o","d","a","f","N","F","c","p","m","u","h"],"mappings":"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","x_google_ignoreList":[0]}