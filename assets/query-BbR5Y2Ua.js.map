{"version":3,"file":"query-BbR5Y2Ua.js","sources":["../../node_modules/@arcgis/core/rest/operations/urlUtils.js","../../node_modules/@arcgis/core/rest/query/operations/query.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nfunction t(n){const o={};for(const e in n){if(\"declaredClass\"===e)continue;const r=n[e];if(null!=r&&\"function\"!=typeof r)if(Array.isArray(r)){o[e]=[];for(let n=0;n<r.length;n++)o[e][n]=t(r[n])}else\"object\"==typeof r?r.toJSON&&(o[e]=JSON.stringify(r)):o[e]=r}return o}export{t as mapParameters};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport t from\"../../../request.js\";import{urlToObject as e,join as n}from\"../../../core/urlUtils.js\";import{getJsonType as r}from\"../../../geometry/support/jsonUtils.js\";import{normalizeCentralMeridian as i}from\"../../../geometry/support/normalizeUtils.js\";import{srToRESTValue as a}from\"../../../geometry/support/spatialReferenceUtils.js\";import{mapParameters as o}from\"../../operations/urlUtils.js\";import{parsePBFFeatureQuery as u}from\"./pbfQueryUtils.js\";import{applyFeatureSetZUnitScaling as l}from\"./queryZScale.js\";const s=\"Layer does not support extent calculation.\";function m(t,e){if(e&&\"extent\"===t.type)return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(e&&\"point\"===t.type)return`${t.x},${t.y}`;const n=t.toJSON();return delete n.spatialReference,JSON.stringify(n)}function y(t,e){const n=t.geometry,i=t.toJSON();delete i.compactGeometryEnabled,delete i.defaultSpatialReferenceEnabled;const o=i;let u,l,s;if(null!=n&&(l=n.spatialReference,s=a(l),o.geometryType=r(n),o.geometry=m(n,t.compactGeometryEnabled),o.inSR=s),i.groupByFieldsForStatistics&&(o.groupByFieldsForStatistics=i.groupByFieldsForStatistics.join(\",\")),i.objectIds&&(o.objectIds=i.objectIds.join(\",\")),i.orderByFields&&(o.orderByFields=i.orderByFields.join(\",\")),!i.outFields||!i.returnDistinctValues&&(e?.returnCountOnly||e?.returnExtentOnly||e?.returnIdsOnly)?delete o.outFields:i.outFields.includes(\"*\")?o.outFields=\"*\":o.outFields=i.outFields.join(\",\"),i.outSR?(o.outSR=a(i.outSR),u=t.outSpatialReference):n&&(i.returnGeometry||i.returnCentroid)&&(o.outSR=o.inSR,u=l),i.returnGeometry&&delete i.returnGeometry,i.outStatistics&&(o.outStatistics=JSON.stringify(i.outStatistics)),i.fullText&&(o.fullText=JSON.stringify(i.fullText)),i.pixelSize&&(o.pixelSize=JSON.stringify(i.pixelSize)),i.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&null!=l&&null!=t.quantizationParameters?.extent&&l.equals(t.quantizationParameters.extent.spatialReference)&&delete i.quantizationParameters.extent.spatialReference,o.quantizationParameters=JSON.stringify(i.quantizationParameters)),i.parameterValues&&(o.parameterValues=JSON.stringify(i.parameterValues)),i.rangeValues&&(o.rangeValues=JSON.stringify(i.rangeValues)),i.dynamicDataSource&&(o.layer=JSON.stringify({source:i.dynamicDataSource}),delete i.dynamicDataSource),i.timeExtent){const t=i.timeExtent,{start:e,end:n}=t;null==e&&null==n||(o.time=e===n?e:`${e??\"null\"},${n??\"null\"}`),delete i.timeExtent}return t.defaultSpatialReferenceEnabled&&null!=l&&null!=u&&l.equals(u)&&(o.defaultSR=o.inSR,delete o.inSR,delete o.outSR),o}async function c(t,e,n,r){const i=null!=e.timeExtent&&e.timeExtent.isEmpty?{data:{features:[]}}:await E(t,e,\"json\",r);return l(e,n,i.data),i}async function f(t,e,n,r){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:n.createFeatureResult()};const i=await d(t,e,r),a=i;return a.data=u(i.data,n),a}function d(t,e,n){return E(t,e,\"pbf\",n)}function p(t,e,n){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):E(t,e,\"json\",n,{returnIdsOnly:!0})}function S(t,e,n){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):E(t,e,\"json\",n,{returnIdsOnly:!0,returnCountOnly:!0})}async function x(t,e,n){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:{count:0,extent:null}};const r=await E(t,e,\"json\",n,{returnExtentOnly:!0,returnCountOnly:!0}),i=r.data;if(i.hasOwnProperty(\"extent\"))return r;if(i.features)throw new Error(s);if(i.hasOwnProperty(\"count\"))throw new Error(s);return r}async function E(r,a,u,l={},s={}){const m=\"string\"==typeof r?e(r):r,c=a.geometry?[a.geometry]:[],f=await i(c,null,{signal:l.signal}),d=f?.[0];null!=d&&((a=a.clone()).geometry=d);const p=o({...m.query,f:u,...s,...y(a,s)});return t(n(m.path,g(a,s)?\"query3d\":\"query\"),{...l,responseType:\"pbf\"===u?\"array-buffer\":\"json\",query:{...p,...l.query}})}function g(t,e){return null!=t.formatOf3DObjects&&!(e.returnCountOnly||e.returnExtentOnly||e.returnIdsOnly)}export{m as encodeGeometry,c as executeQuery,S as executeQueryForCount,x as executeQueryForExtent,p as executeQueryForIds,f as executeQueryPBF,d as executeQueryPBFBuffer,y as queryToQueryStringParameters,E as runQuery};\n"],"names":["t","n","o","e","r","s","m","y","i","u","l","a","_a","c","E","f","d","p","S","x","g"],"mappings":"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","x_google_ignoreList":[0,1]}