{"version":3,"file":"OverrideHelper-BY3qVKDN.js","sources":["../../node_modules/@arcgis/core/views/2d/arcade/callExpressionWithFeature.js","../../node_modules/@arcgis/core/symbols/cim/OverrideHelper.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport e from\"../../../core/Error.js\";import r from\"../../../core/Logger.js\";import{unquantizeMultipoint as t,unquantizePolyline as o,unquantizePolygon as n,unquantizePoint as a}from\"../../../geometry/support/quantizationUtils.js\";function s(e,t,o,n,a){if(null==e)return null;const s=e.referencesGeometry()&&a?i(t,n,a):t,u=e.repurposeFeature(s);try{return e.evaluate({...o,$feature:u},e.services)}catch(c){return r.getLogger(\"esri.views.2d.support.arcadeOnDemand\").warn(\"Feature arcade evaluation failed:\",c),null}}const u=new Map;function i(e,r,t){const{transform:o,hasZ:n,hasM:a}=t;u.has(r)||u.set(r,c(r));const s=u.get(r)(e.geometry,o,n,a);return{...e,geometry:s}}function c(s){const u={};switch(s){case\"esriGeometryPoint\":return(e,r,t,o)=>a(r,u,e,t,o);case\"esriGeometryPolygon\":return(e,r,t,o)=>n(r,u,e,t,o);case\"esriGeometryPolyline\":return(e,r,t,n)=>o(r,u,e,t,n);case\"esriGeometryMultipoint\":return(e,r,o,n)=>t(r,u,e,o,n);default:return r.getLogger(\"esri.views.2d.support.arcadeOnDemand\").error(new e(\"mapview-arcade\",`Unable to handle geometryType: ${s}`)),e=>e}}export{s as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.31/esri/copyright.txt for details.\n*/\nimport e from\"../../Color.js\";import{isRGB as r}from\"../../core/colorUtils.js\";import{clone as i}from\"../../core/lang.js\";import{createRendererExpression as t}from\"../../support/arcadeOnDemand.js\";import{normalizeDashEffectTemplate as s,toLowerCaseProps as o,normalizePrimitiveOverrideProps as a,attributesToFields as c,analyzeTextParts as l,assignTextValuesFromFeature as n,uncapitalize as p}from\"./utils.js\";import f from\"../../views/2d/arcade/callExpressionWithFeature.js\";const m=e=>{if(!e)return[0,0,0,0];const{r,g:i,b:t,a:s}=e;return[r,i,t,255*s]};class y{static findApplicableOverrides(e,r,i){if(e&&r){if(e.primitiveName){let t=!1;for(const r of i)if(r.primitiveName===e.primitiveName){t=!0;break}if(!t)for(const s of r)s.primitiveName===e.primitiveName&&i.push(s)}switch(e.type){case\"CIMPointSymbol\":case\"CIMLineSymbol\":case\"CIMPolygonSymbol\":if(e.effects)for(const t of e.effects)y.findApplicableOverrides(t,r,i);if(e.symbolLayers)for(const t of e.symbolLayers)y.findApplicableOverrides(t,r,i);break;case\"CIMTextSymbol\":break;case\"CIMSolidStroke\":case\"CIMPictureStroke\":case\"CIMGradientStroke\":case\"CIMSolidFill\":case\"CIMPictureFill\":case\"CIMHatchFill\":case\"CIMGradientFill\":case\"CIMVectorMarker\":case\"CIMCharacterMarker\":case\"CIMPictureMarker\":if(e.effects)for(const t of e.effects)y.findApplicableOverrides(t,r,i);if(e.markerPlacement&&y.findApplicableOverrides(e.markerPlacement,r,i),\"CIMVectorMarker\"===e.type){if(e.markerGraphics)for(const t of e.markerGraphics)y.findApplicableOverrides(t,r,i),y.findApplicableOverrides(t.symbol,r,i)}else\"CIMCharacterMarker\"===e.type?y.findApplicableOverrides(e.symbol,r,i):\"CIMHatchFill\"===e.type?y.findApplicableOverrides(e.lineSymbol,r,i):\"CIMPictureMarker\"===e.type&&y.findApplicableOverrides(e.animatedSymbolProperties,r,i)}}}static findEffectOverrides(e,r){if(!e)return null;if(\"CIMGeometricEffectDashes\"===e.type&&s(e),!r||!e.primitiveName)return{type:\"cim-effect-param\",effect:e,overrides:[]};const i=o(e),t=e.primitiveName,c=[];for(const s of r)s.primitiveName===t&&c.push(o(s));return{type:\"cim-effect-param\",effect:i,overrides:a(c)}}static async resolveSymbolOverrides(e,r,t,s,o,a,l){if(!e?.symbol)return null;let{symbol:n,primitiveOverrides:p}=e;const f=!!p;if(!f&&!s)return n;n=i(n),p=i(p);let m=!0;if(r||(r={attributes:{}},m=!1),f){if(m||(p=p.filter((e=>!e.valueExpressionInfo?.expression.includes(\"$feature\")))),l||(p=p.filter((e=>!e.valueExpressionInfo?.expression.includes(\"$view\")))),p.length>0){const e={spatialReference:t,fields:c(r.attributes),geometryType:o};await y.createRenderExpressions(p,e),y.evaluateOverrides(p,r,o??\"esriGeometryPoint\",a,l)}y.applyOverrides(n,p)}return s&&y.applyDictionaryTextOverrides(n,r,s,null),n}static async createRenderExpressions(e,r){const i=[];for(const s of e){const e=s.valueExpressionInfo;if(!e||y._expressionToRenderExpression.has(e.expression))continue;const o=t(e.expression,r.spatialReference,r.fields);i.push(o),o.then((r=>y._expressionToRenderExpression.set(e.expression,r)))}i.length>0&&await Promise.all(i)}static evaluateOverrides(e,i,t,s,o){const a={$view:{scale:o?.scale}};for(const c of e){c.value&&\"object\"==typeof c.value&&r(c.value)&&(\"Color\"===c.propertyName||\"StrokeColor\"===c.propertyName)&&(c.value=m(c.value));const e=c.valueExpressionInfo;if(!e)continue;const o=y._expressionToRenderExpression.get(e.expression);o&&(c.value=f(o,i,a,t,s))}}static applyDictionaryTextOverrides(e,r,i,t,s=\"Normal\"){if(e?.type)switch(e.type){case\"CIMPointSymbol\":case\"CIMLineSymbol\":case\"CIMPolygonSymbol\":case\"CIMTextSymbol\":{const o=e.symbolLayers;if(!o)return;for(const a of o)a&&\"CIMVectorMarker\"===a.type&&y.applyDictionaryTextOverrides(a,r,i,t,\"CIMTextSymbol\"===e.type?e.textCase:s)}break;case\"CIMVectorMarker\":{const s=e.markerGraphics;if(!s)return;for(const e of s)e&&y.applyDictionaryTextOverrides(e,r,i,t)}break;case\"CIMMarkerGraphic\":{const o=e.textString;if(o&&o.includes(\"[\")){const a=l(o,i);e.textString=n(r,a,t,s)}}}}static applyOverrides(e,r,i,t){if(e.primitiveName)for(const s of r)if(s.primitiveName===e.primitiveName){const r=p(s.propertyName);if(t&&t.push({cim:e,nocapPropertyName:r,value:e[r]}),i){let r=!1;for(const t of i)t.primitiveName===e.primitiveName&&(r=!0);r||i.push(s)}null!=s.value&&(e[r]=s.value)}switch(e.type){case\"CIMPointSymbol\":case\"CIMLineSymbol\":case\"CIMPolygonSymbol\":if(e.effects)for(const s of e.effects)y.applyOverrides(s,r,i,t);if(e.symbolLayers)for(const s of e.symbolLayers)y.applyOverrides(s,r,i,t);break;case\"CIMTextSymbol\":break;case\"CIMSolidStroke\":case\"CIMSolidFill\":case\"CIMVectorMarker\":if(e.effects)for(const s of e.effects)y.applyOverrides(s,r,i,t);if(\"CIMVectorMarker\"===e.type&&e.markerGraphics)for(const s of e.markerGraphics)y.applyOverrides(s,r,i,t),y.applyOverrides(s.symbol,r,i,t)}}static restoreOverrides(e){for(const r of e)r.cim[r.nocapPropertyName]=r.value}static buildOverrideKey(e){let r=\"\";for(const i of e)void 0!==i.value&&(r+=`${i.primitiveName}${i.propertyName}${JSON.stringify(i.value)}`);return r}static toValue(r,i){if(\"DashTemplate\"===r)return i.split(\" \").map((e=>Number(e)));if(\"Color\"===r){const r=new e(i).toRgba();return r[3]*=255,r}return i}}y._expressionToRenderExpression=new Map;export{y as OverrideHelper};\n"],"names":["s","e","t","o","n","a","i","u","c","r","m","y","l","p","f","_a"],"mappings":"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","x_google_ignoreList":[0,1]}