const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./symbolLayerUtils-DPhq-pd8.js","./spike-symbols.js","./spike-symbols.css","./LRUCache-LcfJ3jIy.js"])))=>i.map(i=>d[i]);
import{aC as a,cy as m,f8 as y,f9 as b,fa as d,fb as k,_ as g}from"./spike-symbols.js";import{C as z}from"./cimSymbolUtils-sW4dnx__.js";import{e as S}from"./LRUCache-LcfJ3jIy.js";import"./utils-Bgq9-INc.js";new S(1e3);new a([128,128,128]);const _=new a("white");function T(t,n){if(!t)return null;let o=null;return m(t)?o=v(t):y(t)&&(o=t.type==="cim"?z(t):t.color?new a(t.color):null),o?h(o,n):null}function v(t){const n=t.symbolLayers;if(!n)return null;let o=null;return n.forEach(l=>{var i;l.type==="object"&&((i=l.resource)!=null&&i.href)||(o=l.type==="water"?l.color:l.material?l.material.color:null)}),o?new a(o):null}function h(t,n){if(n==null||t==null)return t;const o=t.toRgba();return o[3]=o[3]*n,new a(o)}function x(t,n,o){const l=t.symbolLayers;if(!l)return;const i=r=>h(n=n??r??(o!=null?_:null),o);l.forEach(r=>{var c,u;if(r.type!=="object"||!((c=r.resource)!=null&&c.href)||n)if(r.type==="water")r.color=i(r.color);else{const e=r.material!=null?r.material.color:null,s=i(e);r.material==null?r.material=new d({color:s}):r.material.color=s,o!=null&&"outline"in r&&((u=r.outline)==null?void 0:u.color)!=null&&(r.outline.color=h(r.outline.color,o))}})}function L(t,n,o){var l;(n=n??t.color)&&(t.color=h(n,o)),o!=null&&"outline"in t&&((l=t.outline)!=null&&l.color)&&(t.outline.color=h(t.outline.color,o))}function U(t,n,o){t&&(n||o!=null)&&(n&&(n=new a(n)),m(t)?x(t,n,o):y(t)&&L(t,n,o))}async function j(t,n){const o=t.symbolLayers;o&&await b(o,async l=>E(l,n))}async function E(t,n){switch(t.type){case"extrude":$(t,n);break;case"icon":case"line":case"text":C(t,n);break;case"path":O(t,n);break;case"object":await R(t,n)}}function C(t,n){const o=p(n);o!=null&&(t.size=o)}function p(t){for(const n of t)if(typeof n=="number")return n;return null}function $(t,n){t.size=typeof n[2]=="number"?n[2]:0}async function R(t,n){const{resourceSize:o,symbolSize:l}=await D(t),i=w(n,o,l);t.width=f(n[0],l[0],o[0],i),t.depth=f(n[1],l[1],o[1],i),t.height=f(n[2],l[2],o[2],i)}function O(t,n){const o=w(n,k,[t.width,void 0,t.height]);t.width=f(n[0],t.width,1,o),t.height=f(n[2],t.height,1,o)}function w(t,n,o){for(let l=0;l<3;l++){const i=t[l];switch(i){case"symbol-value":{const r=o[l];return r!=null?r/n[l]:1}case"proportional":break;default:if(i&&n[l])return i/n[l]}}return 1}async function D(t){const{computeObjectLayerResourceSize:n}=await g(()=>import("./symbolLayerUtils-DPhq-pd8.js"),__vite__mapDeps([0,1,2,3]),import.meta.url),o=await n(t,10),{width:l,height:i,depth:r}=t,c=[l,r,i];let u=1;for(let e=0;e<3;e++){const s=c[e];if(s!=null){u=s/o[e];break}}for(let e=0;e<3;e++)c[e]==null&&(c[e]=o[e]*u);return{resourceSize:o,symbolSize:c}}function f(t,n,o,l){switch(t){case"proportional":return o*l;case"symbol-value":return n??o;default:return t}}function I(t,n){const o=p(n);if(o!=null)switch(t.type){case"simple-marker":t.size=o;break;case"picture-marker":{const l=t.width/t.height;l>1?(t.width=o,t.height=o*l):(t.width=o*l,t.height=o);break}case"simple-line":t.width=o;break;case"text":t.font.size=o}}async function V(t,n){if(t&&n)return m(t)?j(t,n):void(y(t)&&I(t,n))}function q(t,n,o){if(t&&n!=null)if(m(t)){const l=t.symbolLayers;l&&l.forEach(i=>{if(i.type==="object")switch(o){case"tilt":i.tilt=(i.tilt??0)+n;break;case"roll":i.roll=(i.roll??0)+n;break;default:i.heading=(i.heading??0)+n}i.type==="icon"&&(i.angle+=n)})}else y(t)&&(t.type!=="simple-marker"&&t.type!=="picture-marker"&&t.type!=="text"||(t.angle+=n))}async function B(t,n){return await t.fetchSymbol(n)||t.fetchCIMSymbol(n)}export{q as D,B as N,V as R,U as g,T as h};
//# sourceMappingURL=utils-C-AEPX7f.js.map
